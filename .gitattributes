import React, { useState, useEffect, useRef } from "react";

const heartCount = 35;
const phrases = [
  "You missed it üòú",
  "Too slow üòè",
  "You don‚Äôt want that üòå",
  "Try again! üòÖ",
  "Almost got me! ü§≠",
  "Keep chasing! üèÉ‚Äç‚ôÇÔ∏è",
  "Nope, not today! üòÑ",
  "Missed me! üòù",
  "Better luck next time! üòâ",
];

const photos = [
  "/photo1.jpg",
  "/photo2.jpg",
  "/photo3.jpg",
  "/photo4.jpg",
  "/photo5.jpg",
  "/photo6.jpg",
];

export default function App() {
  const [noPos, setNoPos] = useState({ top: "50%", left: "50%" });
  const [noPhrase, setNoPhrase] = useState("NO üôÑ");
  const [screen, setScreen] = useState("main"); // main, yes, memories, letter
  const [graffitiElements, setGraffitiElements] = useState([]);
  const [slideIndex, setSlideIndex] = useState(0);

  const noBtnRef = useRef(null);

  // Move NO button to random position and change phrase
  const moveNo = () => {
    const padding = 80;
    const width = window.innerWidth;
    const height = window.innerHeight;
    const left = Math.random() * (width - padding) + "px";
    const top = Math.random() * (height - padding) + "px";
    setNoPos({ left, top });
    const phrase = phrases[Math.floor(Math.random() * phrases.length)];
    setNoPhrase(phrase);
  };

  // Start slideshow auto
  useEffect(() => {
    let interval;
    if (screen === "memories") {
      interval = setInterval(() => {
        setSlideIndex((i) => (i + 1) % photos.length);
      }, 2800);
    } else {
      setSlideIndex(0);
    }
    return () => clearInterval(interval);
  }, [screen]);

  // Generate graffiti emojis scattered randomly for YES screen
  useEffect(() => {
    if (screen === "yes") {
      const graffitiEmojis = ["üíñ", "üíò", "üòç", "‚ú®", "‚ù§Ô∏è"];
      let elements = [];
      for (let i = 0; i < 40; i++) {
        elements.push({
          id: i,
          emoji: graffitiEmojis[Math.floor(Math.random() * graffitiEmojis.length)],
          style: {
            top: Math.random() * 90 + "vh",
            left: Math.random() * 90 + "vw",
            fontSize: 16 + Math.random() * 40 + "px",
            position: "fixed",
            userSelect: "none",
            pointerEvents: "none",
            animation: `pop 0.6s ease forwards`,
          },
        });
      }
      setGraffitiElements(elements);
    } else {
      setGraffitiElements([]);
    }
  }, [screen]);

  return (
    <>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&display=swap');

        * {
          box-sizing: border-box;
          font-family: 'Poppins', cursive, Comic Sans MS, cursive;
        }

        body,html,#root {
          margin: 0; padding: 0;
          height: 100%;
          overflow: hidden;
          background: radial-gradient(circle at top, #ff8fab, #ff4d6d);
          color: white;
          text-align: center;
          user-select: none;
          -webkit-tap-highlight-color: transparent;
        }

        .heart {
          position: fixed;
          font-size: 20px;
          opacity: 0.75;
          animation: float 8s linear infinite;
          pointer-events: none;
          user-select: none;
          z-index: 0;
        }
        @keyframes float {
          0% { transform: translateY(110vh) scale(1); opacity: 0; }
          50% { opacity: 1; }
          100% { transform: translateY(-10vh) scale(1.4); opacity: 0; }
        }

        .container {
          position: relative;
          height: 100vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          padding: 15px;
          z-index: 10;
        }

        h1, h2 {
          margin: 10px 15px 20px;
          font-weight: 900;
          text-shadow: 0 6px 20px rgba(0,0,0,0.7);
        }
        h1 {
          font-size: 2.5rem;
        }
        h2 {
          font-size: 2.8rem;
        }

        button {
          font-weight: 900;
          font-size: 1.1rem;
          padding: 14px 36px;
          margin: 12px;
          border-radius: 50px;
          border: none;
          cursor: pointer;
          box-shadow: 0 8px 22px rgba(0,0,0,0.35);
          transition: all 0.3s ease;
          user-select: none;
          -webkit-tap-highlight-color: transparent;
        }
        button:focus {
          outline: none;
        }

        #yesBtn {
          background: linear-gradient(135deg, #00ffcc, #00c896);
          color: #000;
          z-index: 12;
        }

        #noBtn {
          background: #111;
          color: white;
          position: fixed;
          z-index: 9999;
          width: 110px;
          text-align: center;
          user-select: none;
        }

        #noBtn:active {
          /* disable clicking */
          pointer-events: none;
        }

        /* Graffiti style */
        .graffiti {
          position: fixed;
          animation: pop 0.6s ease forwards;
          user-select: none;
          pointer-events: none;
          z-index: 999;
          font-weight: 900;
          color: white;
          text-shadow:
            0 0 5px #ff497c,
            0 0 10px #ff497c,
            0 0 20px #ff497c,
            0 0 30px #ff497c;
        }
        @keyframes pop {
          from { transform: scale(0); }
          to { transform: scale(1); }
        }

        /* Slideshow */
        .slideshow {
          max-width: 90vw;
          max-height: 70vh;
          border-radius: 20px;
          overflow: hidden;
          box-shadow: 0 14px 40px rgba(0,0,0,0.5);
          user-select: none;
          touch-action: pan-y;
        }
        .slide-img {
          width: 100%;
          height: 70vh;
          object-fit: cover;
          display: none;
          border-radius: 20px;
          user-select: none;
          -webkit-user-drag: none;
        }
        .slide-img.active {
          display: block;
        }

        /* Letter */
        .letter {
          font-size: 1.15rem;
          line-height: 1.7;
          background: rgba(255,255,255,0.15);
          padding: 20px;
          border-radius: 20px;
          backdrop-filter: blur(10px);
          max-width: 90vw;
          margin: 0 auto 30px;
          user-select: text;
          white-space: pre-line;
          color: white;
          font-weight: 600;
          text-shadow: 0 2px 6px rgba(0,0,0,0.7);
        }

        /* Dancing gif */
        .dance-gif {
          width: 260px;
          max-width: 90vw;
          margin: 0 auto 30px;
          user-select: none;
          pointer-events: none;
          border-radius: 15px;
          box-shadow: 0 8px 24px rgba(0,0,0,0.5);
        }

        /* Nav Buttons */
        .nav-buttons {
          margin-top: 10px;
          display: flex;
          justify-content: center;
          gap: 20px;
          flex-wrap: wrap;
        }

        /* Back Button */
        .backBtn {
          background: #ff4d6d;
          color: white;
          box-shadow: 0 8px 22px rgba(255, 77, 109, 0.75);
        }

        @media (max-width: 480px) {
          h1 {
            font-size: 2rem;
          }
          h2 {
            font-size: 2.2rem;
          }
          button {
            padding: 12px 28px;
            font-size: 1rem;
            margin: 8px;
          }
        }
      `}</style>

      {/* Floating Hearts */}
      {[...Array(heartCount)].map((_, i) => (
        <div
          key={i}
          className="heart"
          style={{
            left: Math.random() * 100 + "vw",
            animationDuration: 5 + Math.random() * 6 + "s",
            animationDelay: Math.random() * 8 + "s",
          }}
        >
          ‚ù§Ô∏è
        </div>
      ))}

      {/* MAIN SCREEN */}
      {screen === "main" && (
        <div className="container" role="main" aria-label="Valentine proposal">
          <h1>üíñ KUKKU, WILL YOU BE MY VALENTINE? üíñ</h1>

          <button
            id="yesBtn"
            onClick={() => setScreen("yes")}
            aria-label="Yes, I will be your Valentine"
          >
            YES üòç
          </button>

          <button
            id="noBtn"
            style={{ top: noPos.top, left: noPos.left }}
            onMouseEnter={moveNo}
            onTouchStart={moveNo}
            aria-live="polite"
            aria-atomic="true"
            tabIndex={-1}
          >
            {noPhrase}
          </button>
        </div>
      )}

      {/* YES SCREEN */}
      {screen === "yes" && (
        <div className="container" role="main" aria-label="Love confirmation">
          <h2>üíò I KNEW YOU LOVE ME üíò</h2>
          <img
            src="https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif"
            alt="Dancing"
            className="dance-gif"
            draggable="false"
          />
          <div className="nav-buttons">
            <button onClick={() => setScreen("memories")}>üì∏ Photo Memories</button>
            <button onClick={() => setScreen("letter")}>üíå Letter</button>
          </div>

          {graffitiElements.map(({ id, emoji, style }) => (
            <span key={id} className="graffiti" style={style} aria-hidden="true">
              {emoji}
            </span>
          ))}
        </div>
      )}

      {/* MEMORIES SCREEN */}
      {screen === "memories" && (
        <div className="container" role="main" aria-label="Photo memories slideshow">
          <h2>üì∏ Our Memories üíñ</h2>
          <div
            className="slideshow"
            role="region"
            aria-live="polite"
            aria-label="Slideshow of photos"
          >
            {photos.map((src, i) => (
              <img
                key={i}
                src={src}
                alt={`Memory photo ${i + 1}`}
                className={`slide-img ${i === slideIndex ? "active" : ""}`}
                draggable="false"
              />
            ))}
          </div>
          <button className="backBtn" onClick={() => setScreen("yes")}>
            ‚¨Ö Back
          </button>
        </div>
      )}

      {/* LETTER SCREEN */}
      {screen === "letter" && (
        <div className="container" role="main" aria-label="Love letter">
          <h2>üíå My Letter To You</h2>
          <div className="letter">
            Dear Kukku ‚ù§Ô∏è{`\n\n`}
            Loving you feels easy, warm, and a little magical.{`\n`}
            You‚Äôre my smile on bad days and my favorite thought on good ones.{`\n`}
            Life with you is my favorite adventure, and I‚Äôd choose you every time.{`\n\n`}
            Forever yours üíñ
          </div>
          <button className="backBtn" onClick={() => setScreen("yes")}>
            ‚¨Ö Back
          </button>
        </div>
      )}
    </>
  );
}

